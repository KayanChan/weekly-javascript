# 第1章 HTTP概述

目录
[toc]

## 1.1 HTTP-因特网的多媒体信使

  **HTTP 超文本传输协议**，HyperText Transfer Protocol, 是应用层协议，使用的是可靠的数据传输协议，确保数据在传输过程中不被破坏或者产生混乱。

## 1.2 Web客户端与服务器

  Web内容存储在Web服务器上，Web服务器使用的是HTTP协议，故Web服务器又称为HTTP服务器。

  HTTP客户端和HTTP服务器构成万维网的基本组件。

  最常见的Web客户端是浏览器。

## 1.3 资源

  Web服务器是Web资源的宿主。

  Web资源可以是静态文件(图片、文本)，也可以是根据需要生成内容的软件程序(网关)。

  ### 1.3.1 媒体类型

  Web服务器会给 HTTP 对象数据附加一个 MIME 类型(MIME type)。

  Web浏览器得到 HTTP 对象数据后查看其 MIME 类型来对应处理(例如 HTML 文件会进行解释并格式化)。

  **MIME类型**是一种文本标记，表示一种主要的对象类型和一个特定的子类型，中间由一条斜杠来分隔。
    
  * HTML格式的文件：text/HTML
  
  * JPEG格式的图片：image/jpeg

  ### 1.3.2 URI

  **URI 统一资源标识符**，Uniform Resource Identifier，即服务器资源名，是可以唯一标识并定位信息资源。

  URI有两种形式：URL 和 URN。

  ### 1.3.3 URL
    
  **URL 统一资源定位符**，Uniform Resource Locator，URI最常见的形式，描述了一台特定服务器上某资源的特定位置。

  URL遵循一种标准格式，包含三个部分：

  1. protocol 访问资源所使用的协议类型。大部分是由HTTP协议 (http://)

  2. server 服务器, 域名 (www.baidu.com)

  3. path 资源地址，路径 (/assets/bg.jpg) 

  ### 1.3.4 URN

  **URN 统一资源名**，Uniform Resource Name，作为特定内容的唯一名称使用，与目前资源所在地无关。

  P2P下载中使用的磁力链接是URN的一种实现，它可以持久化的标识一个BT资源，资源分布式的存储在P2P网络中，无需中心服务器用户即可找到并下载它

## 1.4 事务  

  **HTTP事务**由一条从客户端发往服务器的请求命令和从服务器发回客户端的响应结果组成。

  客户端跟服务器通过名为**HTTP报文**的格式化数据块进行通信。

  ### 1.4.1 方法

  **HTTP 方法**: 每一条HTTP请求报文都包含一个方法(HTTP methods)，方法会通知服务器执行对应的动作。

  常见的五种HTTP方法：

  1. GET - 从服务器向客户端发送命名资源

  2. PUT - 将来自客户端的数据储存到一个命名的服务器资源中去

  3. DELETE - 从服务器中删除命名资源

  4. POST - 将客户端数据发送到一个服务器网关应用程序

  5. HEAD - 仅发送命名资源响应中的HTTP首部

  ### 1.4.2 状态码

  每一条HTTP响应报文返回都会协带一个三位数字的**HTTP 状态码**，告知客户端请求是否成功，是否采取其他动作。

  常见的三种HTTP状态码：

  1. 200 - 文档正确返回

  2. 302 - 重定向，到其他地方去获取资源

  3. 404 - 找不到资源

  ### 1.4.3 Web页面中可以包含多个对象

  复合Web页面要为每个嵌入式资源使用单独一个HTTP事务，即一个Web页面就是一组资源的整合。

## 1.5 报文

  **HTTP报文**是由一行一行的字符串(纯文本)组成的。

  **请求报文**: 从Web客户端发往Web服务器的HTTP报文

  **响应报文**: 从服务器发往客户端的报文

  HTTP报文包括三个部分：

  1. 起始行：请求报文中用来说明要做什么(GET /test/hi-there HTTP/1.0)，响应报文用来说明出现了什么情况(HTTP/1.0 200 OK)

  2. 首部字段: 零个或多个，key-value的形式 (Accept: text/*)

  3. 主体：可选，请求主体中可包括要发给服务器的数据，响应主体装载了要返回给客户端的数据

## 1.6 连接

  HTTP无需关心网络通信的具体细节，而联网的细节交给了通用、可靠的因特网传输协议TCP/IP。

  ### 1.6.1 TCP/IP

  **TCP 传输控制协议**，Transmission Control Protocol，**IP 网际协议**，Internet Protocol， TCP/IP是全世界的计算机和网络设备常用的层次化分组交互网络协议集。

  HTTP使用TCP来传输其报文数据。
  
  TCP提供了无差错的数据传输、按序传输、未分段的数据流(任意时刻、任意尺寸将数据发送出去)。

  HTTP网络协议栈(从上到下)：

  * HTTP - 应用层

  * TCP - 传输层

  * IP - 网络层

  * 网络特有的链路接口 - 数据链路层

  * 物理网络硬件 - 物理层

  ### 1.6.2 连接、IP地址及端口号

  用IP地址和端口在客户端和服务器之间建立一条TCP/IP连接后，HTTP客户端再向服务器发送请求报文。

  通过URL获得HTTP服务器的IP地址和端口

  IP地址是数字形式的，域名是文本形式的。**DNS 域名服务**，Domain Name Sevice，机制是将域名转成IP地址。

  HTTP的URL默认端口号是80。

  基本的浏览器连接处理步骤：

  1. 浏览器从URL中解析出服务器的主机名

  2. 通过DNS获得服务器的IP地址

  3. 浏览器从URL中解析出服务器的端口

  4. 用IP地址和端口在客户端和服务器之间建立一条TCP/IP连接

  5. HTTP客户端向服务器发送请求报文

  6. 服务器向客户端发送响应报文

  7. 关闭连接，浏览器显示文档

  ### 1.6.3 使用Telnet实例

  **Telnet程序**可以将键盘连接到某个目标TCP端口，并将此TCP端口的输出回送到显示屏上。

  Telnet常用远程终端会话(DOC命令行窗口)，几乎能连接所有的TCP服务器(包括HTTP服务器)。

  Web服务器会将Telnet程序当做一个Web客户端来处理。

  Telnet会查找主机名和端口，并打开一条连接，连接到IP地址和端口上监听的Web服务器，输入请求命令会得到服务器的响应报文。

  Telnet能很好地模拟HTTP客户端，但不能作为服务器使用。

## 1.7 协议版本

  HTTP协议版本更替：

  1. HTTP/0.9 - HTTP最初版本，仅支持GET请求方法，且仅支持访问HTML格式资源

  2. HTTP/1.0 - 增加支持POST请求方法和HEAD，根据Content-Type可以支持多种数据格式，支持cache，但每次TCP/IP连接只能发送一个请求

  3. HTTP/1.1 - 一个TCP/IP连接允许多个HTTP请求(持久连接，keep alive)，并且允许同时发出(增加并发性)，新增PUT、PATCH、DELETE等，但存在请求队列阻塞问题，HTTP连接是无状态连接，会重复添加字段，降低带宽的利用率

  4. HTTP/2.0(HTTP-NG) - 增加双工模式(不仅客户端能够同时发送多个请求，服务端也能同时处理多个请求，解决了队头堵塞的问题)，建表建立索引，客户端服务器共同使用表，避免重复字段，并以压缩方式传输提高利用率

  当前主流的协议版本还是HTTP/1.1版本

## 1.8 Web的结构组件

  代理 - 位于客户端和服务器之间的HTTP中间实体

  缓存 - HTTP的仓库，使常用页面的副本可以保存离客户端更近的地方

  网关 - 连接其他应用程序的特殊Web服务器

  隧道 - 对HTTP通信报文进行盲转发的特殊代理

  Agent代理 - 发起自动HTTP请求的半智能Web客户端

  ### 1.8.1 代理

  **代理**位于客户端和服务器之间，接收所有客户端的HTTP请求，并将这些请求转发给服务器(可能会请求进行修改之后转发)。出于安全考虑，通常会将代理作为转发所有Web流量的可信任中间节点使用。

  ### 1.8.2 缓存
  **Web缓存(Web cache)**或**代理缓存(proxy cache)**是一种将经过代理传送的常用文档复制保存起来的(特殊)的HTTP代理服务器。下一次请求同一文档的客户端即可享受缓存的私有副本所提供的服务。保存常用文档本地副本的代理缓存起到提高性能的作用。

  ### 1.8.3 网关
  **网关**作为其他服务器的中间实体使用的一种特殊服务器。通常用于将HTTP流量转换成其他的协议。

  一个HTTP/FTP网关会通过HTTP请求接受对FTP URI的请求。HTTP/FTP网关通过FTP协议获取文档，封装成一条HTTP报文发送给客户端。

  ### 1.8.4 隧道
  **隧道**建立起来后，会在两条链接之间对原始数据进行盲转发的HTTP应用程序。

  HTTP隧道通常用来在一条或者多条HTTP连接上转发非HTTP数据，转发时不会窥探数据。

  常见用法：通过HTTP连接承载加密的安全套接字层(SSL，Secure Socket Layer)

  安全套接字层(SSL，Secure Socket Layer)是为网络通信提供安全及数据完整性的一种安全协议。安全套接字层提供的服务：
  1. 认证用户和服务器，确保数据发送到正确的客户机和服务器；
  2. 加密数据以防止数据中途被盗窃；
  3. 维护数据的完整性，确保数据再传输过程中不被改变；















