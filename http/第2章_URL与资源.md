# 第2章 URL与资源

目录
[toc]

## 读书笔记
1. URL & URN 的区别：URL-资源位置 URN-资源名称
2. URL的语法：`<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>`
3. URL编码机制，通过转义表示法来避开安全字符表示法带来的限制，`%` + 两个表示字符ASCII码的十六进制数
4. HTTP默认端口80，HTTPS默认端口443
5. URL片段(hash部分)并不发送给服务器

## 2.1 浏览因特网资源
  **URL**是通过描述**资源的位置**来标识资源的，是浏览器寻找信息时所需的资源地址。

  *e.g.* 一个人将浏览器指向一个URL，浏览器就会在幕后发生适当的协议报文来获得人们所期望的资源。

  **URI**是一类更通用的资源标识符，由两个主要的子集URL和URN构成。

  **URN**是通过**名字**来识别资源的，与所处位置无关。

  HTTP规范将更通用的概念URI作为其资源标识符，实际上，**HTTP应用程序处理的只是URI的URL子集**。

  URL主要由三部分构成：
  1. URL方案：告知Web客户怎么访问资源 *e.g.* 使用http协议
  2. 服务器位置：告知Web客户资源位于何处
  3. 资源路径：说明了请求的是服务器上哪个特定的本地资源(磁盘中)

  URL除了http协议，还可以通过其他协议来访问资源，例如：
  1. mailto: 用于发送邮件的URL协议
  2. ftp：文件传输协议
  3. rtsp: 多媒体传送协议

## 2.2 URL的语法
  URL建立在由9部分构成的通用格式上：`<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>`
  1. **scheme** - 方案 `无`
  2. user - 用户 `匿名`
  3. password - 密码 `email地址`
  4. **host** - 主机 `无`
  5. port - 端口 `默认端口，http默认端口80`
  6. **path** - 路径 `无`
  7. params - 参数，名/值对，`;`分隔 `无`
  8. query - 查询，用`?`将其跟URL其余部分分隔 `无`
  9. frag - 片段，客户端内部使用，用`#`将其跟URL其余部分分隔 `无`

  ### 2.2.1 方案
  **方案**规定如何访问指定资源的主要标识符(负责解析URL的应用程序应该使用什么协议)。

  方案名与字母大小写无关。

  ### 2.2.2 主机与端口
  URL的主机与端口组件能够告知应用程序是哪台机器装载了资源，以及目标资源在机器的什么地方。

  **主机**标识了因特网上能够访问资源的宿主机器。主机名可以用域名或者IP地址来表示。

  **端口**标识了服务器正在监听的网络端口。对下层使用TCP协议的HTTP来说默认端口就是80。

  ### 2.2.3 用户名和密码
  很多服务器都要求输入用户名和密码才允许用户访问数据。

  *e.g.* FTP服务器，`ftp://joe:joepassword@www.joes-hardware.com/sales_info.txt`

  默认插入匿名用户名`anonymous`和默认的密码`IE会发送IEUser, Netscape Navigator会发送mozilla`

  用户名和密码用`:`隔开

  ### 2.2.4 路径
  **路径**标识了资源位于服务器的具体位置。

  用字符`/`将HTTP URL的路径组件划分一些路径段。每个路径段都有自己的参数组件。

  ### 2.2.5 参数
  **参数**的提供，即为应用程序提供了访问资源所有的附加信息，能正确地与服务器进行交互。

  *e.g.* FTP协议有两种传输模式，二进制跟文本，如果是转送图片那就需要选择二进制传输模式而非文本。

  例子`ftp://prep.ai.mit.edu/pub/gnu;type=d`中参数名`type`，值为`d`

  ### 2.2.6 查询字符串
  **查询字符串**是以一系列的“名/值”对的形式出现，名值对之间用字符`&`分隔。

  URL的查询组件和标识网关资源的URL路径一起被发送给网关资源。

  ### 2.2.7 片段
  **片段**表示一个资源内部的片段，用`#`与URL其他部分分隔。

  *e.g.* URL可以指向HTML文档中一个特定的图片或者小节。

  HTTP服务器通常只处理整个对象，而不是对象的片段，**片段并不发送给服务器(URL片段由客户端使用)**。

  浏览器从服务器中获得整个资源后，会根据片段来显示具体的那部分资源。

## 2.3 URL快捷方式
  ### 2.3.1 相对URL
  URL有两种方式：绝对的和相对的。

  绝对URL包含有访问资源所需的全部信息。

  相对URL是不完整的，可能只是URL的片段或者一小部分，需要对所属资源的基础URL进行解析。

  如何找到基础URl：
  1. 在资源中显式提供 - HTML文档中`<base>`标记，通过它来转换HTML文档中所有相对URL
  2. 封装资源的基础URL - 所属的资源URL作为基础，即HTML文档里面使用到用的相对URL将以HTML文档的URL作为基础URL
  3. 没有基础URL - 有一个相对URL，也可能只是一个不完整的或者损坏的URL

  通过`RFC 2396`中制定的算法(相对URL所缺少的URL组件部分继承自基础URL的URL组件)解析相对引用，将相对URL转换成绝对URL。

  ### 2.3.2 自动扩展URL
  用户不需要输入完整的URL，浏览器自动扩展。
  自动扩展方式：
  1. 主机名扩展
  2. 历史扩展

## 2.4 各种令人头疼的字符
  ### 2.4.1 URL字符集
  通过**转义**序列，用**US-ASCII字符集的有限子集**对任意字符值或数据进行编码，实现可移植性和完整性。

  ### 2.4.2 编码机制
  通过转义表示法来避开安全字符表示法带来的限制，这种转义表示法包含一个百分号(%)，后面跟着两个表示字符ASCII码的十六进制数。

  *e.g.* 编码字符示例
  1. 字符`~`，ASCII码`126(0x7E)`，转义后`%7E`
  2. 字符空格，ASCII码`32(0x20)`，转义后`%20`
  3. 字符`%`，ASCII码`37(0x25)`，转义后`%25`

  ### 2.4.3 字符限制
  有着特殊含义的字符将会被保留起来，跟某些因特网网关或者协议产生混淆的字符将会限制起来：
  1. `%`，保留作为编码字符的转义标志
  2. `/`，保留作为路径组件中分隔路径段的定界符
  3. `.`，保留在路径组件中使用
  4. `..`，保留在路径组件中使用
  5. `#`，保留作为分段定界符使用
  6. `?`，保留作为查询字符串定界符使用
  7. `;`，保留作为参数定界符使用
  8. `:`，保留作为方案、用户与口令、主机与端口的定界符使用
  9. `$ +`，保留
  10. `@ & =`，在某些方案的上下文有特殊的含义保留
  11. `{ } | \ ^ ~ [ ] ' < > "`，受限，各种传输Agent代理，使用受限不安全
  12. `0x00-0x1F, 0x7F`，受限，超出US-ASCII字符集可打印区间
  13. `>0x7F`，受限，不在US-ASCII字符集的7二进制范围内

  ### 2.4.4 另外一点说明
  客户端应用程序在想其他应用程序发送任意URL之前需要吧不安全或者受限字符都进行编码转换
## 2.5 方案的世界
  http - 超文本传送协议方案 `http://<host>:<port>/<path>?<query>#<frag>` 省略端口则为80
  https - https使用网景的SSL，SSL为HTTP连接提供了端到端的加密机制 `https://<host>:<port>/<path>?<query>#<frag>` 省略端口则为443
  ftp - 文件传输协议 `ftp://<user>:<password>@<host>:<port>/<path>;<params>`
  file - 一台指定主机(通过本地磁盘、网络文件系统或其他一些文件共享系统)上课直接访问的文件 `file://<host>/<path>`
## 2.6 未来展望
  URL的缺点在于资源不存在被移走时无效，无法对对象进行定位

  **URN** - 给定了资源的名称和其他一些情况，无论资源移到何处都能追踪

  **PURL(persistent uniform resource locators) 永久统一资源定位符**是用URL来实现URN功能

  PURL的基本思想是搜索资源的过程中引入另一个中间层，通过一个[中间资源定位服务器](http://purl.oclc.org)对资源的实际URL进行登记和跟踪
## 2.7 更多信息 - 略

